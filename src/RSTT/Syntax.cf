comment "--" ;
comment "{-" "-}" ;

layout toplevel ;
layout "with", "where", "prove" ;

token Label (upper (letter | digit | '_')*) ;
token Var (lower (letter | digit | '_')*) ;
token Line (('-' | '‚Äî') ('-' | '‚Äî') ('-' | '‚Äî') ('-' | '‚Äî')*) ;

Program.  Program ::= [Decl] ;

DeclCube.         Decl ::= "cube" Label "with" "{" [PointConDecl] "}" ;
DeclTopePrefix.   Decl ::= "tope" Label "(" [Cube] ")" "with" "{" [TopeRule] "}" ;
DeclShape.        Decl ::= "shape" Var ":=" Shape ;
DeclCommandProve. Decl ::= "prove" "{" Sequent "}" ;
separator Decl ";" ;

Shape.  Shape ::= "{" PointPattern ":" Cube "|" Tope "}" ;

PointPatternVar.  PointPattern ::= Var ;
PointPatternPair. PointPattern ::= "‚ü®" PointPattern "," PointPattern "‚ü©" ;

NullaryPointConDecl.  PointConDecl ::= "point" Label ;
PrefixPointConDecl.   PointConDecl ::= "point" Label "(" [Cube] ")" ;
separator PointConDecl ";" ;

CubeProduct.  Cube  ::= Cube "√ó" Cube1 ;
CubeUnit.     Cube1 ::= "ùüô" ;
CubeCon.      Cube1 ::= Label ;
CubeVar.      Cube1 ::= Var ;
coercions Cube 1 ;
separator nonempty Cube "," ;

TopeRule. TopeRule ::= "rule" RuleName "where" "{" [Sequent] Line ";" Sequent "}" ;
separator TopeRule ";" ;

RuleName. RuleName ::= String ;

Sequent. Sequent ::= CubeContext "|" TopeContext "‚ä¢" Tope ;
separator Sequent ";" ;

CubeContextEmpty. CubeContext ::= "‚ãÖ" ;
CubeContextNonEmpty. CubeContext ::= [PointDecl] ;

PointDecl. PointDecl ::= Var ":" Cube ;
separator nonempty PointDecl "," ;

TopeContextEmpty. TopeContext ::= "‚ãÖ" ;
TopeContextNonEmpty. TopeContext ::= [Tope] ;

TopeTop.      Tope  ::= "‚ä§" ;
TopeBottom.   Tope  ::= "‚ä•" ;
TopeImplies.  Tope  ::= Tope "‚áí" Tope1 ;
TopeOr.       Tope1 ::= Tope1 "‚à®" Tope2 ;
TopeAnd.      Tope2 ::= Tope2 "‚àß" Tope3 ;
TopeEQ.       Tope3 ::= Point "‚â°" Point ;
TopeCon.      Tope3 ::= Label "(" [Point] ")" ;
TopeVar.      Tope3 ::= Var ;
coercions Tope 3 ;
separator nonempty Tope "," ;

PointUnit.    Point ::= "‚ãÜ" ;
PointPair.    Point ::= "‚ü®" Point "," Point "‚ü©" ;
PointFirst.   Point ::= "ùúã‚ÇÅ" "(" Point ")" ;
PointSecond.  Point ::= "ùúã‚ÇÇ" "(" Point ")" ;
PointCon.     Point ::= Label "(" [Point] ")" ;
nullaryPoint. Point ::= Label ;
PointVar.     Point ::= Var ;
define nullaryPoint con = PointCon con [] ;
separator nonempty Point "," ;
